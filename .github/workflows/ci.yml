name: Localoco CI Pipeline

on:
    push:
    pull_request:
    workflow_dispatch:

# cancel ongoing actions
concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    checks:
        name: ðŸš§ Static Analyses & Unit Tests
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Code
              uses: actions/checkout@v4

            - name: Setup Bun
              uses: oven-sh/setup-bun@v2
              with:
                  bun-version: "1.3"

            - name: Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: "10.20.0"

            - name: Install Dependencies
              run: pnpm install --frozen-lockfile

            - name: Run Static Analyses (lint, type, and formatting checks) Concurrently
              run: concurrently --kill-others-on-fail "bun run lint:check" "bun run type:check" "bun run format:check"

            - name: Run all tests concurrently
              run: bun test --concurrent
